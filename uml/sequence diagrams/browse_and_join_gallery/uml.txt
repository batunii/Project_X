title Browse/Join Galleries - Full Flow

' ============== ACTORS & COMPONENTS ==============
actor "User" as User
participant "Controller/Input Manager" as Ctrl
participant "HUD" as HUD
participant "Security Manager" as Sec
participant "Profile Manager" as Prof
participant "Network Manager" as Net
participant "Room Manager" as Room
participant "Collaboration/Communication" as Collab
participant "Canvas" as Canvas
participant "Event Logger" as Log

' ============== TRIGGER ==============
User ->> Ctrl : Presses Join
Ctrl --> HUD: Open "Join a Gallery"
HUD ->> Sec: Is user authenticated?
Sec --> HUD: Session status (signed-in / guest)
Log --> Log: Log: HUD.OpenJoin

' ============== LISTING/DIRECTORY ==============
alt Signed-in
  HUD ->> Prof: Fetch user galleries & workspaces
  Prof --> HUD: Gallery/workspace list
end
HUD ->> Net: Fetch public gallery directory
Net --> HUD: Public gallery list

HUD --> User: Show: public list + "Enter Code" (+ personal/workspace if signed-in)

  User ->> Ctrl: Selects option
  Ctrl --> HUD: Selects option (Public / Personal Workspace / Enter Code)
  Log --> Log: Log: SelectionMade


' ----- Flow C: Private Gallery via Join Code -----
alt Private gallery (join code)
  User ->> Ctrl: Enter code
  Ctrl ->> HUD: Enter join code
  HUD ->> Sec: Validate code (access control)
  Sec ->> Net: Resolve galleryId from code
  Net --> Sec: galleryId or error
  Sec --> HUD: Validation result
end

HUD ->> Net: Request join(galleryId)
Net ->> Room: Load room state
Room ->> Canvas: Load artworks for private gallery
Canvas --> Net: Asset refs/streams ready
Net --> HUD: Gallery session ready
HUD ->> Collab: Join presence/voice/text
Collab --> User: Presence/chat enabled
Log --> Log: Log: JoinedGallery (code)


' ============== NOTES (Reqs, Pre/Post) ==============
' note over Net, Collab
' Requirements: stable internet â€¢ low-latency multi-user sync
' end note
' note over Sec
' Private galleries require valid code/invite (authZ/authN)
' end note
' note over Room, Canvas
' Postcondition: gallery/workspace rendered with artworks
' end note

@enduml